name: Analyze PowerShell Script

on: [push, pull_request]

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Run PSScriptAnalyzer
      run: |
        Install-Module -Name PSScriptAnalyzer -Force -Scope CurrentUser
        $results = Invoke-ScriptAnalyzer -Path ./powershell/ -Recurse
        $results | ConvertTo-Json | Out-File analysis-results.json
      shell: pwsh
    
    - name: Run SonarScanner
      run: |
        sonar-scanner \
          -Dsonar.projectKey=your_project_key \
          -Dsonar.sources=. \
          -Dsonar.host.url=http://192.168.0.106:9000 \
          -Dsonar.login=your_sonarqube_token \
          -Dsonar.externalIssuesReportPaths=analysis-results.json
